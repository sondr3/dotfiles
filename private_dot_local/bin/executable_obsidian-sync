#!/usr/bin/env bash

OBSIDIAN="${HOME}/Documents/Deus Vault"
HOST=$(cat /etc/hostname)

cd "${OBSIDIAN}" || exit 1

git pull --rebase --autostash

CHANGES=$(git status --porcelain | wc -l)

if [ "$CHANGES" -eq 0 ]; then
	exit 0
fi

export GIT_COMMITTER_NAME="Auto Sync"
export GIT_COMMITTER_EMAIL="auto@${HOST}"
export GIT_AUTHOR_NAME="Auto Sync"
export GIT_AUTHOR_EMAIL="auto@${host}"

git add .
git commit -q -m "Sync from ${HOST} at $(date +'%Y-%m-%d %H:%M:%S')"
git push -q
